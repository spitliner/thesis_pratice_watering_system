import typia from 'typia';
import authentication from './auth.js';
async function authRequest(request, response, next) {
    const uid = request.cookies.uid;
    const tokenType = request.cookies.tokenType;
    if (!typia.is(uid) || !typia.is(tokenType)) {
        return response.status(401).json({ error: 'unauthenticated request' });
    }
    if (undefined === request.headers.authorization) {
        return response.status(401).json({ error: 'unauthenticated request' });
    }
    const bearerToken = request.headers.authorization.split(' ');
    if ('Bearer' !== bearerToken[0] || 2 !== bearerToken.length) {
        return response.status(401).json({ error: 'wrong token format' });
    }
    const payload = await authentication.verifyToken(bearerToken[1]);
    if (undefined !== payload.error || undefined === payload.uid) {
        return response.status(403).json({ error: 'expired or invalid token' });
    }
    if (uid !== payload.uid || 'jwt' !== tokenType) {
        return response.status(403).json({ error: 'expired or invalid token' });
    }
    next();
}
export default authRequest;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwcmVzcy1hdXRoLmpzIiwic291cmNlUm9vdCI6Ii9ob21lL2FwMS9EZXNrdG9wL1RoZXNpcy90aGVzaXNfcHJhdGljZV93YXRlcmluZ19zeXN0ZW0vQmFja2VuZC9zb3VyY2UvIiwic291cmNlcyI6WyJtaWRkbGV3YXJlL2V4cHJlc3MtYXV0aC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDMUIsT0FBTyxjQUFjLE1BQU0sV0FBVyxDQUFDO0FBRXZDLEtBQUssVUFBVSxXQUFXLENBQUMsT0FBZ0IsRUFBRSxRQUFrQixFQUFFLElBQWtCO0lBQy9FLE1BQU0sR0FBRyxHQUFZLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDO0lBQ3pDLE1BQU0sU0FBUyxHQUFZLE9BQU8sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDO0lBRXJELElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFTLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBUyxTQUFTLENBQUMsRUFBRSxDQUFDO1FBQ3pELE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBQyxLQUFLLEVBQUUseUJBQXlCLEVBQUMsQ0FBQyxDQUFDO0lBQ3pFLENBQUM7SUFFRCxJQUFJLFNBQVMsS0FBSyxPQUFPLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQzlDLE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBQyxLQUFLLEVBQUUseUJBQXlCLEVBQUMsQ0FBQyxDQUFDO0lBQ3pFLENBQUM7SUFFRCxNQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDN0QsSUFBSSxRQUFRLEtBQUssV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxXQUFXLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDMUQsT0FBTyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFDLEtBQUssRUFBRSxvQkFBb0IsRUFBQyxDQUFDLENBQUM7SUFDcEUsQ0FBQztJQUVELE1BQU0sT0FBTyxHQUFHLE1BQU0sY0FBYyxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNqRSxJQUFJLFNBQVMsS0FBSyxPQUFPLENBQUMsS0FBSyxJQUFJLFNBQVMsS0FBSyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDM0QsT0FBTyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFDLEtBQUssRUFBRSwwQkFBMEIsRUFBQyxDQUFDLENBQUM7SUFDMUUsQ0FBQztJQUVELElBQUksR0FBRyxLQUFLLE9BQU8sQ0FBQyxHQUFHLElBQUksS0FBSyxLQUFLLFNBQVMsRUFBRSxDQUFDO1FBQzdDLE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBQyxLQUFLLEVBQUUsMEJBQTBCLEVBQUMsQ0FBQyxDQUFDO0lBQzFFLENBQUM7SUFFRCxJQUFJLEVBQUUsQ0FBQztBQUNYLENBQUM7QUFFRCxlQUFlLFdBQVcsQ0FBQyJ9